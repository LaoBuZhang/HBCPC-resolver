# 河北省省赛滚榜系统

本系统是2024年CCPC河北省省赛是使用的滚榜系统

省赛使用的是pta系统，因此本系统只能在使用pta进行比赛时使用

滚榜使用的是icpctools中的resolver，本程序是将pta的数据转换为resolver可以使用的数据

作者：laobuzhang

## 使用说明
其中有多个py文件，作用如下：
- resolver_functions.py
    - 主要函数文件，存放要使用到的函数
- resolver_main.py
    - main文件，比赛开始后，运行此文件即可生成resolver可以使用的数据
    - 生成的数据是ndjson类型的数据（可以有多个对象的json，在vscode中会爆红，但是不影响使用）
    - 生成的数据文件就是resolver.json文件
- resolver_trans.py
    - 生成队伍信息的文件，会根据team.xlsx和pta中的数据，创建为队伍数据文件，保存在./data/team.json文件中
    - 在运行main文件前，请先运行此文件生成队伍信息
    - 运行此文件前，请先完成team.xlsx文件，完成pta中队伍账号的创建，完成pta比赛中加入用户组
    - 该文件想要完美使用，需要修改
        - 该文件中我调用了三次获取pta队伍的接口，是因为我们只有200多个队伍，每次最多返回100条数据，所以调用三次可以获取到全部队伍
        - 你可能需要根据你的队伍数量进行修改
        - 接口链接中的filter参数我是直接粘贴的pta上的链接，具体什么作用还不清楚，可以直接复制你自己的pta上的这个参数使用
        - 还有这个文件中的header部分和board_functions.py中的header部分，我的header是直接在浏览器复制的，最好对比一下你的浏览器中的header，不一样的改成你自己的（因为header中很多字段我也不知道他们是什么作用）

## 配置文件
在config文件夹中，有两个配置文件，需要在运行前修改
- cfg.json
    - problemId: pta的比赛的id，可以直接进入比赛，在连接中找到比赛id
    - cookie: pta中拥有该比赛管理权限的账号的cookie，获取方式为登陆该账号，在f12中找到cookie并复制下来
- config.json
    - 对于这个文件，我是直接从外榜系统copy过来的，所以会有一些信息没有用到（我懒得一个一个找了）
    - 所以如果你使用了外榜系统（也是我写的，我一个叫做HBCPC-board的仓库[仓库地址](https://github.com/LaoBuZhang/HBCPC-board)），可以直接copy外榜系统的这个文件
    - 这里边主要配置一些比赛相关的信息
    - 从上到下依次为
    - 比赛名称，比赛开始时间戳，比赛结束时间戳，封榜时长，罚时，题目数量，题目编号，队伍类型（推荐不要改变），组织类型（推荐不要改变），显示状态（推荐不要改变），奖牌数（根据自己情况修改），题目颜色和对应气球颜色（根据自己需求修改），图标（应该是ICPC和CCPC两种）,其它选项（推荐不修改）
- contest_judgement.json
    - 主要是评测题目的结果类型，一般不用该就可以使用，因为pta就这些错误信息
    - 想添加别的错误信息的话可以自己改
    - 字段分别为：id，错误缩写，错误名称，该状态是否算通过，该状态是否罚时
- contest_language.json
    - 比赛中用到的语言
    - 我们的比赛只让用到了里边的几种
    - 你想添加的话可以加
    - 但是resolver_functions.py文件中40多行有一个写死的语言转换逻辑，那一部分可能也需要随之更改（除非你不介意其它语言就用Other Language表示，我是懒得改了）
- contest_problem.json
    - 题目信息
    - 字段分别为：id，题目标号，题目名称，颜色名称，颜色16进制码

## 运行环境
### 本系统
我使用的时vscode，安装了coderunner插件，直接右键 run code就能运行程序

同时安装了python3.10

使用到了一些第三方包，需要自己pip install（有些包的名字和安装时使用的名字不一样，所以尽量查一查）

### resolver
使用本系统生成数据文件后，还需要使用resolver进行滚榜

resolver需要的环境是：
- java8或以上的版本（因为这个工具的运行主要依靠lib文件夹中的jar包）
- jvm必须是32位的

## team.xlsx
该文件为队伍表
- 队伍名前加星号表示是打星队伍
- 序号一列代码中没有用到，根据自己需求编写就行（但是要有）
- 校内队伍序号一列代码中中没有用到，根据自己需求编写就行（但是要有）
- 赛场和座位号根据自己情况编写：
    - 我们的情况是，使用了6个教室作为赛场（6061就是其中的一个教室号）
    - 每个教室都有一个对应的字母编号，例如A对应6061,B对应6064...
    - 每个教室都只有两位数个队伍，所以我们的座位号格式为A01,B15...
- PTA学号：
    - 格式为：比赛缩写比赛年份-座位号
    - 我们是河北省省赛（HBCPC），2024年（2024），座位号上文说过，所以最终是（HBCPC2024-A01）
    - 建议和我们一样的形式命名学号，因为pta中学号是唯一的（比如你今年用A01，明年还想用A01，明年会把今年的覆盖掉，我们这样子编写学号不会重复）
    - 当然也可以使用别的形式，但是要保证表格中的和PTA中的格式一致（表格中有的pta中也要有）
- PTA姓名就是在pta中创建队伍是给的名字，


## 程序原理
主要原理是调用pta的接口，获取到pta中提交列表的数据

然后把pta中得到的提交数据的格式转换为resolver需要的数据格式

队伍信息的获取也是一样的原理


## 程序使用
1. 将配置文件和team.xlsx表格填写完成
2. 运行resolver_trans.py文件，生成队伍数据(./data/team.json)
3. 运行resolver_main.py文件，生成resolver要使用的数据（./data/resolver.json）
4. 运行resolver2.5文件夹中的awards程序（windows运行bat，linux运行sh）
5. 等待后弹出窗口，在窗口中：disk->选中生成的resolver.json文件->connect
6. 在新的窗口中，点击Template按钮，通过参数修改奖项配置
7. 在窗口中单击每一个队伍，使用右侧的Edit和Add按钮可以单独修改和添加某一个队伍的奖项
    - 最好是在Template设置金银铜，最快解题奖
    - 类似于最佳女队，专科金银铜（数量比较少）等特殊奖项，可以手动添加
    - 如果专科队伍较多，可以尝试修改代码中的生成group的部分，将专科和本科换分为不同的group，然后根据group分别办法金银铜（我没有实现，需要你自己改）
8. 点击右侧Save会生成最终滚榜使用的json文件（不出意外应该叫做event-feed.json）
9. 使用指令运行resolver2.5文件夹中的resolver程序（windows运行bat，linux运行sh）
    - ~~~
      resolver.bat event-feed.json文件的位置
      ~~~
10. 稍微等待后，就可以开始滚榜

## 滚榜程序的使用

滚榜程序运行时可以指定文件夹运行，可以在其中添加队伍图片，各种logo等，想要的话需要自己百度研究一下，本系统没有这些，直接使用的event-feed.json文件运行的

滚榜工具使用按键我也是查的，但是感觉不太对，放在这里仅供参考，可以自己阅读官方文件（当时时间紧任务重，我没时间看）

- ctrl+q 停止
- 空格/f 下一步
- r 上一步
- +/= 加速
- -/_ 减速


334344865这是domejudge的qq群，里边的同学们都很热情，关于resolver有问题可以去里边询问